## Docker Tutorial

This tutorial is in three parts and covers:  
A) Retrieve an existing Docker image and deploy it locally.  
B) Modify and deploy a docker image locally.    
C) Save an image to the your own private Azure Container Registry (ACR) and deploy on Azure.   
  
This tutorial is included to complete the coverage of the microsoft learning path and because it is relatively simple.  In practice, you would likely use a slightly different (more modern) stack:  
1) BuildKite would be used in place of docker build.  Docker build is deprecated for linux deployments and is only used for microsoft builds now.  Its still useful to see the build pattern in case you coe across it in the wild.
2) Multi-staged docker files - these separate the build environment from the deployment container environment making containers smaller, faster and safer to deploy.  
3) Docker compose - docker compose is used to coordinate building and deployment of multiple containers at once (say a web-server and a back-end database) as part of the same process.  
4) Github first - its quite likely you would start development of a project within github where you would include a docker file to provide a stable and reproducible development environment for yourself and others as part of your development process.
These variations will be covered in a later tutorial.  
  


## Docker Tutorial Part A: Retrieve an existing Docker image and deploy it locally.

These instructions are based on this [tutorial](https://learn.microsoft.com/en-us/training/modules/intro-to-containers/3-exercise-deploy-docker-image-locally).  "Exercise - Retrieve an existing Docker image and deploy it locally - Training | Microsoft Learn"

---

### üêã Pull a Docker image from a registry

```bash
# Pull the ASP.NET sample web app image from the Microsoft Container Registry
docker pull mcr.microsoft.com/dotnet/samples:aspnetapp
```

---

### üì¶ Show local images

```bash
# List all Docker images stored locally
docker image ls
```

---

### üöÄ Run a container in detached mode

```bash
# Start the pulled image as a container in the background, mapping port 8080 on the host to port 8080 in the container
docker run -d -p 8080:8080 mcr.microsoft.com/dotnet/samples:aspnetapp
```

---

### üìÑ View running containers

```bash
# List running Docker containers
docker ps
```

---

### üõë Stop a specific running container

```bash
# Stop the running container, replacing <NAME> with the actual container name
docker container stop <NAME>
```

---

### üìã View all containers (including stopped)

```bash
# List all containers, including those that have exited
docker ps -a
```

---

### üóëÔ∏è Remove a stopped container

```bash
# Remove the stopped container from your local Docker host, replacing <NAME> with the container name
docker container rm <NAME>
```

---

### üì¶ List images again

```bash
# List all Docker images currently available locally
docker image ls
```

---

### üóëÔ∏è Remove the pulled image

```bash
# Delete the ASP.NET sample image from your local machine
docker image rm mcr.microsoft.com/dotnet/samples:aspnetapp
```

---

‚úÖ These commands illustrate the full **local Docker workflow** from pulling an image, running and inspecting it, to stopping and cleaning up both containers and images. ([Microsoft Learn][1])

[1]: https://learn.microsoft.com/en-us/training/modules/intro-to-containers/3-exercise-deploy-docker-image-locally "Exercise - Retrieve an existing Docker image and deploy it locally - Training | Microsoft Learn"

## Docker Tutorial Part B: Modify and deploy a docker image locally

Below is a step-by-step instruction list that creates an image from an existing codebase by adding a Dockerfile.  The web-service is deployed locally.  Based on this tutorial(https://learn.microsoft.com/en-us/training/modules/intro-to-containers/5-exercise-create-custom-docker-image). ([Microsoft Learn][1])  


---

## Commands + what each is doing (Bash-friendly)

### 1) Download the sample web app source code

```bash
git clone https://github.com/MicrosoftDocs/mslearn-hotel-reservation-system.git
```

([Microsoft Learn][1])

---

### 2) Move into the `src` directory (where the .NET projects live)

```bash
cd mslearn-hotel-reservation-system/src
```

([Microsoft Learn][1])

---

### 3) Create a new empty `Dockerfile` (Bash replacement for `copy NUL Dockerfile`)

```bash
touch Dockerfile
```

([Microsoft Learn][1])

---

### 4) Open the Dockerfile in a terminal editor (Bash replacement for `notepad Dockerfile`)

Pick one:

```bash
nano Dockerfile
```

or

```bash
vim Dockerfile
```

(or `code Dockerfile` if you‚Äôre using VS Code / Codespaces)

([Microsoft Learn][1])

---

### 5) Paste the complete Dockerfile contents (combined into one instruction)

Paste the following into `Dockerfile`:

```dockerfile
FROM mcr.microsoft.com/dotnet/core/sdk:2.2
WORKDIR /src
COPY ["/HotelReservationSystem/HotelReservationSystem.csproj", "HotelReservationSystem/"]
COPY ["/HotelReservationSystemTypes/HotelReservationSystemTypes.csproj", "HotelReservationSystemTypes/"]
RUN dotnet restore "HotelReservationSystem/HotelReservationSystem.csproj"
COPY . .
WORKDIR "/src/HotelReservationSystem"
RUN dotnet build "HotelReservationSystem.csproj" -c Release -o /app
RUN dotnet publish "HotelReservationSystem.csproj" -c Release -o /app
EXPOSE 80
WORKDIR /app
ENTRYPOINT ["dotnet", "HotelReservationSystem.dll"]
```

([Microsoft Learn][1])

---

## Explanation of each Dockerfile line (what it does)

1. **`FROM mcr.microsoft.com/dotnet/core/sdk:2.2`**
   Uses Microsoft‚Äôs .NET Core SDK 2.2 image as the base (so `dotnet` build tools are available). ([Microsoft Learn][1])

2. **`WORKDIR /src`**
   Sets the working directory inside the image to `/src` (subsequent commands run relative to this). ([Microsoft Learn][1])

3. **`COPY ["/HotelReservationSystem/HotelReservationSystem.csproj", "HotelReservationSystem/"]`**
   Copies the main project file into the image (into `/src/HotelReservationSystem/`). ([Microsoft Learn][1])

4. **`COPY ["/HotelReservationSystemTypes/HotelReservationSystemTypes.csproj", "HotelReservationSystemTypes/"]`**
   Copies the library project file into the image (into `/src/HotelReservationSystemTypes/`). ([Microsoft Learn][1])

5. **`RUN dotnet restore "HotelReservationSystem/HotelReservationSystem.csproj"`**
   Restores NuGet dependencies for the main project (downloads required packages). ([Microsoft Learn][1])

6. **`COPY . .`**
   Copies the rest of the source tree from your local `src` directory into the image‚Äôs `/src`. ([Microsoft Learn][1])

7. **`WORKDIR "/src/HotelReservationSystem"`**
   Changes working directory to the main project folder. ([Microsoft Learn][1])

8. **`RUN dotnet build "HotelReservationSystem.csproj" -c Release -o /app`**
   Builds the project in Release mode and writes build outputs into `/app`. ([Microsoft Learn][1])

9. **`RUN dotnet publish "HotelReservationSystem.csproj" -c Release -o /app`**
   Publishes the app (produces deployable outputs; strips intermediate build artifacts) into `/app`. ([Microsoft Learn][1])

10. **`EXPOSE 80`**
    Documents that the container listens on port 80 (the app‚Äôs HTTP port). ([Microsoft Learn][1])

11. **`WORKDIR /app`**
    Sets working directory to `/app` (where the published binaries are). ([Microsoft Learn][1])

12. **`ENTRYPOINT ["dotnet", "HotelReservationSystem.dll"]`**
    Defines the command that runs when the container starts: launch the web app with `dotnet`. ([Microsoft Learn][1])

---

### 6) Build the Docker image from the Dockerfile (note the trailing `.`)

```bash
docker build -t reservationsystem .
```

([Microsoft Learn][1])

---

### 7) Verify the image exists in your local image store

```bash
docker image list
```

([Microsoft Learn][1])

---

### 8) Run the container in the background, mapping host port 8080 ‚Üí container port 80

```bash
docker run -p 8080:80 -d --name reservations reservationsystem
```

([Microsoft Learn][1])

(Then browse to `http://localhost:8080/api/reservations/1` per the tutorial.) ([Microsoft Learn][1])

---

### 9) Check container status (including stopped containers)

```bash
docker ps -a
```

([Microsoft Learn][1])

---

### 10) Stop the running container (graceful shutdown)

```bash
docker container stop reservations
```

([Microsoft Learn][1])

---

### 11) Remove the stopped container (cleanup)

```bash
docker rm reservations
```

([Microsoft Learn][1])

---

[1]: https://learn.microsoft.com/en-us/training/modules/intro-to-containers/5-exercise-create-custom-docker-image "Exercise - Customize a Docker image to run your own web app - Training | Microsoft Learn"

## Docker Tutorial Part C: Save an image to the your own private Azure Container Registry (ACR) and deploy on Azure.

These instructions are based on this [tutorial](https://learn.microsoft.com/en-us/training/modules/intro-to-containers/7-exercise-deploy-docker-image-to-container-instance).  "Exercise - Deploy a Docker image to an Azure Container Instance - Training | Microsoft Learn"
Keeping your own ACR allows you to maintain docker images privately but this comes at the cost of having to maintaining this Azure resource.  Images could just as easily be maintained locally (if sharing is not needed) or using a free-tier of a public repository like GHCR (Github Container Registry).  GHCR is popular for developers already using GitHub; it offers free storage and bandwidth for public images and a generous free tier for private ones.  Docker Hub also has a free tier but only allows one private container.

---

## Exercise instructions: Deploy a Docker image to an Azure Container Instance

### 1) Create an Azure Container Registry (ACR) so you have a private place to store your image in Azure

**Why:** Azure Container Instances (ACI) needs a registry it can pull your image from; ACR is Azure‚Äôs native private registry. ([Microsoft Learn][1])

* In the Azure portal, create a **Container Registry** with:

  * Resource group: `learn-deploy-container-aci-rg`
  * Pricing plan: **Standard**
* After it deploys, open **Access keys** and enable **Admin user** (for this exercise only).
* Note down: **Registry name**, **Login server**, **Username**, **Password**. ([Microsoft Learn][1])

---

### 2) Tag your local image so it points at your ACR registry

**Why:** Tagging tells Docker ‚Äúthis local image should be pushed to *that* registry/repository name.‚Äù ([Microsoft Learn][1])

```bash
docker tag reservationsystem:latest <registry-name>.azurecr.io/reservationsystem:latest
```

([Microsoft Learn][1])

---

### 3) Verify the image now has the new tag

**Why:** This confirms you‚Äôll push the correct image to the correct registry address. ([Microsoft Learn][1])

```bash
docker image ls
```

([Microsoft Learn][1])

---

### 4) Log in to your Azure Container Registry from Docker

**Why:** You must authenticate before pushing images to a private registry. ([Microsoft Learn][1])

```bash
docker login <login-server>
```

When prompted, enter the **username** and **password** from ACR Access keys. ([Microsoft Learn][1])

---

### 5) Push the tagged image up to ACR

**Why:** This uploads the image layers so Azure services (like ACI) can pull and run it. ([Microsoft Learn][1])

```bash
docker push <registry-name>.azurecr.io/reservationsystem:latest
```

([Microsoft Learn][1])

---

### 6) Confirm in the Azure portal that the image exists in ACR

**Why:** Before creating ACI, verify the image is actually present (repository + tag). ([Microsoft Learn][1])

* In your registry, go to **Repositories**
* Confirm `reservationsystem` exists and has tag `latest`. ([Microsoft Learn][1])

---

### 7) Create an Azure Container Instance using your private image from ACR

**Why:** This is the ‚Äúdeployment‚Äù step‚ÄîACI pulls your image and runs it as a managed container with a public endpoint. ([Microsoft Learn][1])

In Azure portal:

* Create resource ‚Üí **Container Instances**
* Basics tab:

  * Resource group: `learn-deploy-container-aci-rg`
  * Container name: `hotelsysteminstance`
  * Image source: **Other registry**
  * Image type: **Private**
  * Image: `<registry-name>.azurecr.io/reservationsystem:latest`
  * Registry login server / username / password: use the values you noted
  * OS Type: **Linux**
* Networking tab:

  * Networking type: **Public**
  * DNS name label: choose a unique label
  * Ports: **80**, protocol **TCP**
* Advanced tab:

  * Restart policy: **Always**
  * Leave environment variables and command override blank
* Review + create ‚Üí Create. ([Microsoft Learn][1])

---

### 8) Find the container‚Äôs public FQDN so you can reach it from the internet

**Why:** The FQDN is the public address where your container is accessible. ([Microsoft Learn][1])

* After deployment, open the container instance resource
* On **Overview**, locate the **FQDN**. ([Microsoft Learn][1])

---

### 9) Test the deployed web app by calling its API endpoint in a browser

**Why:** This validates the full pipeline: local image ‚Üí ACR ‚Üí ACI ‚Üí public endpoint. ([Microsoft Learn][1])

Open:

```text
http://<FQDN>/api/reservations/1
```

You should see a JSON response for reservation 1. ([Microsoft Learn][1])

---

## Notes (common gotchas that stop the tutorial working)

* If you can‚Äôt see an FQDN/Public endpoint, double-check **Networking type = Public** and **Port 80** is open. ([Microsoft Learn][1])
* Enabling **Admin user** is convenient for the exercise; in real deployments, prefer identity-based access and keep admin disabled.

[1]: https://learn.microsoft.com/en-us/training/modules/intro-to-containers/7-exercise-deploy-docker-image-to-container-instance "Exercise - Deploy a Docker image to an Azure Container Instance - Training | Microsoft Learn"
